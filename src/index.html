<!DOCTYPE html>
<html lang="zh-CN" data-theme="light-blue">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>旭日图思维导图编辑器</title>
    <meta name="description" content="基于ECharts的现代化旭日图思维导图编辑器，支持可视化编辑、主题切换、数据导入导出">
    <meta name="keywords" content="思维导图,旭日图,ECharts,可视化,编辑器">
    
    <!-- 第三方库 -->
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- 本地样式 -->
    <link rel="stylesheet" href="styles/base/reset.css">
    <link rel="stylesheet" href="styles/base/variables.css">
    <link rel="stylesheet" href="styles/base/typography.css">
    <link rel="stylesheet" href="styles/base/layout.css">
    <link rel="stylesheet" href="styles/components/buttons.css">
    <link rel="stylesheet" href="styles/components/toolbar.css">
    <link rel="stylesheet" href="styles/components/context-menu.css">
    <link rel="stylesheet" href="styles/components/modal.css">
    <link rel="stylesheet" href="styles/components/status-bar.css">
    <link rel="stylesheet" href="styles/animations/transitions.css">
    <link rel="stylesheet" href="styles/animations/keyframes.css">
    <link rel="stylesheet" href="styles/main.css">
    
    <!-- PWA支持 -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#36A1D6">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <!-- 图标 -->
    <link rel="icon" href="assets/icons/system/sun.svg" type="image/svg+xml">
    <link rel="apple-touch-icon" href="assets/icons/system/sun.svg">
</head>
<body>
    <div class="app-container">
        <!-- 头部工具栏 -->
        <header class="app-header">
            <div class="logo">
                <i class="fas fa-sun"></i>
                <h1>旭日图思维导图</h1>
            </div>
            
            <nav class="main-toolbar" id="mainToolbar">
                <div class="toolbar-group">
                    <button class="toolbar-btn" id="btnNew" title="新建 (Ctrl+N)">
                        <i class="fas fa-file"></i>
                        <span>新建</span>
                    </button>
                    <button class="toolbar-btn" id="btnSave" title="保存 (Ctrl+S)">
                        <i class="fas fa-save"></i>
                        <span>保存</span>
                    </button>
                    <div class="toolbar-separator"></div>
                    <button class="toolbar-btn" id="btnUndo" title="撤销 (Ctrl+Z)">
                        <i class="fas fa-undo"></i>
                        <span>撤销</span>
                    </button>
                    <button class="toolbar-btn" id="btnRedo" title="重做 (Ctrl+Y)">
                        <i class="fas fa-redo"></i>
                        <span>重做</span>
                    </button>
                </div>
                
                <div class="toolbar-group">
                    <button class="toolbar-btn" id="btnAddRoot" title="添加根节点">
                        <i class="fas fa-plus-circle"></i>
                        <span>添加根节点</span>
                    </button>
                    <button class="toolbar-btn" id="btnEdit" title="编辑节点">
                        <i class="fas fa-edit"></i>
                        <span>编辑</span>
                    </button>
                    <button class="toolbar-btn" id="btnDelete" title="删除节点 (Delete)">
                        <i class="fas fa-trash"></i>
                        <span>删除</span>
                    </button>
                </div>
                
                <div class="toolbar-group">
                    <button class="toolbar-btn" id="btnExport" title="导出">
                        <i class="fas fa-download"></i>
                        <span>导出</span>
                    </button>
                    <button class="toolbar-btn" id="btnImport" title="导入">
                        <i class="fas fa-upload"></i>
                        <span>导入</span>
                    </button>
                    <div class="toolbar-separator"></div>
                    <button class="toolbar-btn" id="btnFullscreen" title="全屏 (F11)">
                        <i class="fas fa-expand"></i>
                        <span>全屏</span>
                    </button>
                </div>
            </nav>
            
            <div class="theme-switcher">
                <button class="theme-btn" id="btnThemeLight" title="浅色蓝主题">
                    <i class="fas fa-sun"></i>
                </button>
                <button class="theme-btn" id="btnThemeDark" title="深色金主题">
                    <i class="fas fa-moon"></i>
                </button>
            </div>
        </header>

        <!-- 主内容区域 -->
        <main class="app-main">
            <div class="chart-container" id="chartContainer">
                <div class="chart-placeholder" id="chartPlaceholder">
                    <i class="fas fa-sun fa-4x"></i>
                    <h2>欢迎使用旭日图思维导图编辑器</h2>
                    <p>点击"添加根节点"开始创建您的思维导图</p>
                    <button class="primary-btn" id="btnStart">
                        <i class="fas fa-plus"></i>
                        开始创建
                    </button>
                </div>
                <div class="chart-wrapper" id="chartWrapper" style="display: none;">
                    <div id="sunburstChart" style="width: 100%; height: 100%;"></div>
                </div>
            </div>
            
            <!-- 侧边栏（节点属性） -->
            <aside class="sidebar" id="sidebar">
                <div class="sidebar-header">
                    <h3><i class="fas fa-info-circle"></i> 节点属性</h3>
                    <button class="sidebar-close" id="btnSidebarClose">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="sidebar-content" id="sidebarContent">
                    <div class="property-group">
                        <label for="nodeName">节点名称</label>
                        <input type="text" id="nodeName" class="property-input" placeholder="输入节点名称">
                    </div>
                    <div class="property-group">
                        <label for="nodeColor">节点颜色</label>
                        <input type="color" id="nodeColor" class="property-input">
                    </div>
                    <div class="property-group">
                        <label for="nodeDescription">描述</label>
                        <textarea id="nodeDescription" class="property-textarea" placeholder="节点描述..."></textarea>
                    </div>
                    <div class="property-actions">
                        <button class="primary-btn" id="btnSaveProperties">
                            <i class="fas fa-save"></i>
                            保存更改
                        </button>
                        <button class="secondary-btn" id="btnCancelProperties">
                            取消
                        </button>
                    </div>
                </div>
            </aside>
        </main>

        <!-- 状态栏 -->
        <footer class="app-footer">
            <div class="status-bar">
                <div class="status-item">
                    <i class="fas fa-circle" id="statusIcon"></i>
                    <span id="statusText">就绪</span>
                </div>
                <div class="status-item">
                    <i class="fas fa-layer-group"></i>
                    <span>节点数: <span id="nodeCount">0</span></span>
                </div>
                <div class="status-item">
                    <i class="fas fa-palette"></i>
                    <span>主题: <span id="themeName">浅色蓝</span></span>
                </div>
                <div class="status-item">
                    <i class="fas fa-history"></i>
                    <span>自动保存: <span id="autoSaveStatus">已启用</span></span>
                </div>
            </div>
        </footer>

        <!-- 右键菜单 -->
        <div class="context-menu" id="contextMenu">
            <ul class="context-menu-list">
                <li class="context-menu-item" data-action="add-child">
                    <i class="fas fa-plus"></i>
                    添加子节点
                </li>
                <li class="context-menu-item" data-action="edit">
                    <i class="fas fa-edit"></i>
                    编辑节点
                </li>
                <li class="context-menu-item" data-action="delete">
                    <i class="fas fa-trash"></i>
                    删除节点
                </li>
                <li class="context-menu-divider"></li>
                <li class="context-menu-item" data-action="expand">
                    <i class="fas fa-expand"></i>
                    展开所有子节点
                </li>
                <li class="context-menu-item" data-action="collapse">
                    <i class="fas fa-compress"></i>
                    收起所有子节点
                </li>
            </ul>
        </div>

        <!-- 模态对话框 -->
        <div class="modal-overlay" id="modalOverlay" style="display: none;">
            <div class="modal" id="modal">
                <div class="modal-header">
                    <h3 class="modal-title" id="modalTitle">对话框标题</h3>
                    <button class="modal-close" id="modalClose">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body" id="modalBody">
                    <!-- 动态内容 -->
                </div>
                <div class="modal-footer" id="modalFooter">
                    <button class="primary-btn" id="modalConfirm">确认</button>
                    <button class="secondary-btn" id="modalCancel">取消</button>
                </div>
            </div>
        </div>

        <!-- 导出菜单 -->
        <div class="dropdown-menu" id="exportMenu" style="display: none;">
            <ul class="dropdown-list">
                <li class="dropdown-item" data-format="json">
                    <i class="fas fa-file-code"></i>
                    导出为JSON
                </li>
                <li class="dropdown-item" data-format="png">
                    <i class="fas fa-file-image"></i>
                    导出为PNG
                </li>
                <li class="dropdown-item" data-format="svg">
                    <i class="fas fa-file-alt"></i>
                    导出为SVG
                </li>
            </ul>
        </div>
    </div>

    <!-- 本地JavaScript文件 -->
    <script src="config.js"></script>
    <script src="core/data-model/BaseNode.js"></script>
    <script src="core/data-model/TreeNode.js"></script>
    <script src="core/data-model/TreeManager.js"></script>
    <script src="core/data-model/HistoryManager.js"></script>
    <script src="core/visualization/SunburstEngine.js"></script>
    <script src="core/visualization/LayoutCalculator.js"></script>
    <script src="core/visualization/GapManager.js"></script>
    <script src="core/visualization/ColorManager.js"></script>
    <script src="core/ui-components/ToolbarController.js"></script>
    <script src="core/ui-components/ContextMenu.js"></script>
    <script src="core/ui-components/ModalSystem.js"></script>
    <script src="core/file-operations/ExportManager.js"></script>
    <script src="core/file-operations/ImportManager.js"></script>
    <script src="core/theme/ThemeManager.js"></script>
    <script src="core/utils/MathUtils.js"></script>
    <script src="core/utils/ColorUtils.js"></script>
    <script src="core/utils/DOMUtils.js"></script>
    <script src="app.js"></script>
    
    <!-- 服务工作者 -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('service-worker.js')
                    .then(registration => {
                        console.log('ServiceWorker注册成功:', registration.scope);
                    })
                    .catch(error => {
                        console.log('ServiceWorker注册失败:', error);
                    });
            });
        }
    </script>
</body>
</html>